<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inspeksi Buku (Katalog)</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-5xl mx-auto bg-white rounded-lg shadow p-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-4">Inspeksi Koleksi Buku</h1>
        <p class="mb-6 text-gray-600">Alat ini menampilkan semua buku yang ada di database Firestore (koleksi 'books'). Gunakan untuk memastikan data sudah masuk dari Admin.</p>
        
        <button onclick="window.location.reload()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 mb-4">
            Refresh Data
        </button>

        <div id="loading" class="text-center py-4">Memuat data...</div>

        <table class="min-w-full bg-white border border-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="py-2 px-4 border-b text-left">Judul</th>
                    <th class="py-2 px-4 border-b text-left">Penulis</th>
                    <th class="py-2 px-4 border-b text-left">Kategori</th>
                    <th class="py-2 px-4 border-b text-left">Cover</th>
                    <th class="py-2 px-4 border-b text-left">ID Dokumen</th>
                </tr>
            </thead>
            <tbody id="bookTable">
                <!-- Data injected here -->
            </tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, getDocs, query } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBvmr1cu8-WnGNiD5M_cla6lxr88QEYu28",
            authDomain: "eperpus-sekolah.firebaseapp.com",
            projectId: "eperpus-sekolah",
            storageBucket: "eperpus-sekolah.firebasestorage.app",
            messagingSenderId: "303647816343",
            appId: "1:303647816343:web:78ad36d2d1be25930547d2"
        };

        const app = initializeApp(firebaseConfig, "InspectBooksApp");
        const db = getFirestore(app);

        async function loadBooks() {
            const table = document.getElementById('bookTable');
            const loading = document.getElementById('loading');
            table.innerHTML = '';
            
            try {
                // Fetch Firestore
                const q = query(collection(db, "books"));
                const querySnapshot = await getDocs(q);
                
                loading.style.display = 'none';

                if (querySnapshot.empty) {
                    table.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-red-500 font-bold">Tidak ada buku ditemukan di koleksi "books".</td></tr>';
                    return;
                }

                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    const title = data.title || data.judul || "(Tanpa Judul)";
                    const author = data.author || data.penulis || "-";
                    const category = data.category || data.kategori || "Umum";
                    const cover = data.coverUrl || data.cover || "";

                    const row = `
                        <tr class="hover:bg-gray-50 border-b">
                            <td class="py-3 px-4 font-medium">${title}</td>
                            <td class="py-3 px-4 text-gray-600">${author}</td>
                            <td class="py-3 px-4">
                                <span class="px-2 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800">
                                    ${category}
                                </span>
                            </td>
                            <td class="py-3 px-4">
                                ${cover ? `<a href="${cover}" target="_blank" class="text-blue-500 underline text-xs">Lihat</a>` : '<span class="text-gray-400 text-xs">No Cover</span>'}
                            </td>
                            <td class="py-3 px-4 text-xs text-gray-400 font-mono">${doc.id}</td>
                        </tr>
                    `;
                    table.innerHTML += row;
                });

            } catch (e) {
                loading.textContent = "Error: " + e.message;
                loading.classList.add('text-red-600');
                console.error(e);
            }
        }

        loadBooks();
    </script>
</body>
</html>